<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - Elkably E-Learning</title>

  <!-- CSS -->
  <link rel="stylesheet" href="/css/studentCSS/student-main.css">
  <link rel="stylesheet" href="/css/studentCSS/courses.css">
  <link rel="stylesheet" href="/css/theme-toggle.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <!-- Meta Tags -->
  <meta name="description" content="My Enrolled Courses - Continue your learning journey">
  <meta name="theme-color" content="#dc2626">
</head>

<body class="<%= theme %>-theme">
  <!-- Student Layout -->
  <div class="student-layout">
    <!-- Include Sidebar -->
    <%- include('partials/student-sidebar', { currentPage: 'courses', student: student }) %>

    <!-- Main Content -->
    <main class="student-main">
      <!-- Include Header -->
      <%- include('partials/student-header', { title: title, student: student, theme: theme, currentPage: 'courses' }) %>

      <!-- Enrolled Courses Content -->
      <div class="student-content">
        <!-- Page Header -->
        <div class="page-header" style="margin-bottom: var(--spacing-xl);">
          <h2 style="color: var(--text-primary); margin-bottom: var(--spacing-sm);">
            My Enrolled Courses
          </h2>
          <p style="color: var(--text-secondary);">
            Continue your learning journey and track your progress across all enrolled courses.
          </p>
        </div>

        <!-- Courses Grid -->
        <% if (enrolledCourses && enrolledCourses.length > 0) { %>
        <div class="courses-grid">
          <% enrolledCourses.forEach(enrollment => { 
                            const course = enrollment.course;
                            const progress = enrollment.progress;
                            const status = enrollment.status;
                            
                            // Skip if course is null or undefined
                            if (!course) return;
                        %>
          <div class="course-card" onclick="window.location.href='/student/course/<%= course._id %>/content'">
            <!-- Course Thumbnail -->
            <div class="course-thumbnail">
              <% if (course.thumbnail) { %>
              <img src="<%= course.thumbnail %>" alt="<%= course.title %>" style="width: 100%; height: 100%; object-fit: cover;">
              <% } else { %>
              <i class="fas fa-book-open"></i>
              <% } %>
            </div>

            <!-- Course Content -->
            <div class="course-content">
              <!-- Course Header -->
              <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--spacing-sm);">
                <h3 class="course-title"><%= course.title %></h3>
                <span class="course-status <%= status %>">
                  <%= status.charAt(0).toUpperCase() + status.slice(1) %>
                </span>
              </div>

              <!-- Course Description -->
              <p class="course-description">
                <%= course.shortDescription || course.description.substring(0, 100) + '...' %>
              </p>

              <!-- Course Meta -->
              <div class="course-meta">
                <span class="course-level"><%= course.level %></span>
                <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                  <i class="fas fa-clock" style="color: var(--text-muted); font-size: 0.75rem;"></i>
                  <span style="font-size: 0.75rem; color: var(--text-muted);"><%= course.duration %>h</span>
                </div>
              </div>

              <!-- Progress Bar -->
              <div class="course-progress">
                <div class="progress-bar" style="width: <%= progress %>%"></div>
              </div>

              <!-- Progress Info -->
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                <span style="font-size: 0.75rem; color: var(--text-muted);">
                  Progress: <%= progress %>%
                </span>
                <span style="font-size: 0.75rem; color: var(--text-muted);">
                  Last accessed: <%= new Date(enrollment.lastAccessed).toLocaleDateString() %>
                </span>
              </div>

              <!-- Course Footer -->
              <div class="course-footer">
                <div style="display: flex; align-items: center; gap: var(--spacing-xs);">
                  <i class="fas fa-book" style="color: var(--text-muted); font-size: 0.75rem;"></i>
                  <span style="font-size: 0.75rem; color: var(--text-muted);">
                    <%= course.topics ? course.topics.length : 0 %> topics
                  </span>
                </div>
                <a href="/student/course/<%= course._id %>/content" class="btn btn-primary btn-sm">
                  <% if (progress === 100) { %>
                  Review
                  <% } else if (progress > 0) { %>
                  Continue
                  <% } else { %>
                  Start
                  <% } %>
                </a>
              </div>
            </div>
          </div>
          <% }); %>
        </div>

        <!-- Pagination -->
        <% if (pagination.totalPages > 1) { %>
        <div class="pagination">
          <% if (pagination.hasPrev) { %>
          <a href="?page=<%= pagination.prevPage %>" class="pagination-item">
            <i class="fas fa-chevron-left"></i>
          </a>
          <% } %>

          <% for (let i = 1; i <= pagination.totalPages; i++) { %>
          <% if (i === pagination.currentPage) { %>
          <span class="pagination-item active"><%= i %></span>
          <% } else { %>
          <a href="?page=<%= i %>" class="pagination-item"><%= i %></a>
          <% } %>
          <% } %>

          <% if (pagination.hasNext) { %>
          <a href="?page=<%= pagination.nextPage %>" class="pagination-item">
            <i class="fas fa-chevron-right"></i>
          </a>
          <% } %>
        </div>
        <% } %>

        <% } else { %>
        <!-- Empty State -->
        <div class="empty-state" style="text-align: center; padding: var(--spacing-2xl);">
          <div style="width: 200px; height: 200px; margin: 0 auto var(--spacing-xl); background-color: var(--bg-secondary); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-book-open" style="font-size: 4rem; color: var(--text-muted); opacity: 0.5;"></i>
          </div>
          <h3 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 1.5rem;">
            No Enrolled Courses
          </h3>
          <p style="color: var(--text-secondary); margin-bottom: var(--spacing-xl); max-width: 500px; margin-left: auto; margin-right: auto;">
            You haven't enrolled in any courses yet. Browse our course catalog to find interesting topics and start your learning journey.
          </p>
          <div style="display: flex; gap: var(--spacing-md); justify-content: center; flex-wrap: wrap;">
            <a href="/#courses" class="btn btn-primary btn-lg">
              <i class="fas fa-search" style="margin-right: var(--spacing-sm);"></i>
              Browse Courses
            </a>
            <a href="/student/wishlist" class="btn btn-outline btn-lg">
              <i class="fas fa-heart" style="margin-right: var(--spacing-sm);"></i>
              View Wishlist
            </a>
          </div>
        </div>
        <% } %>
      </div>
    </main>
  </div>

  <!-- JavaScript -->
  <script>
    // Add hover effects and interactions
    document.addEventListener('DOMContentLoaded', function() {
      const courseCards = document.querySelectorAll('.course-card');

      courseCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-4px)';
        });

        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
        });
      });
    });

    // Progress bar animation
    function animateProgressBars() {
      const progressBars = document.querySelectorAll('.progress-bar');

      progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';

        setTimeout(() => {
          bar.style.width = width;
        }, 100);
      });
    }

    // Animate progress bars when page loads
    window.addEventListener('load', animateProgressBars);
  </script>
</body>

</html>